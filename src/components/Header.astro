---
// Header.astro - Main navigation header using Momentum Design app header
import '../styles/header.css'

import { Image } from 'astro:assets';
import LogoASJR from '../assets/images/header/logo-asjr.png'

import { List } from "@phosphor-icons/react";

import { Astronav, MenuItems, MenuIcon, Dropdown, DropdownItems, DropdownSubmenu } from "astro-navbar";

export interface Props {
  class?: string;
}

const { class: className = "" } = Astro.props;

// Get current path for active navigation state
const currentPath = Astro.url.pathname;

// Get base URL from Astro environment
const baseUrl = import.meta.env.BASE_URL;

// Navigation items with proper base path handling
const navItems = [
  { label: 'About us', href: `${baseUrl}about` },
  { label: 'What we do', href: `${baseUrl}what-we-do` },
  { label: 'Resources', href: `${baseUrl}resources` },
  { label: 'Blog', href: `${baseUrl}blog` },
  { label: 'Get involved', href: `${baseUrl}get-involved` }
];

const seekHelpLink = baseUrl + "resources";

---

<script>
  // Import Momentum icon component
  import '@momentum-design/components/dist/components/icon/index.js';
  import '@momentum-design/components/dist/components/toggle/index.js';
  import '@momentum-design/components/dist/components/buttonlink/index.js';
</script>

<header>
    <nav class="nav-container">
      <a href={baseUrl} class="nav-logo">
        <Image src={LogoASJR} alt="Advocates for Social Justice Reform logo" />
      </a>

      <div class="nav-container-right">
        <div class="nav-localization-toggle">
        <mdc-toggle name="toggleSpanish" value="false" label="Español"></mdc-toggle>
        </div>

        <button class="menu-icon" aria-label="Open menu" aria-expanded="false">
          <div class="list-icon">
                <span></span>
                <span></span>
                <span></span>
          </div>
          <div class="x-icon" style="display: none;">
          </div>
        </button>
                
        <ul class="nav-menu">
          {navItems.map((item) => (
            <li><a href={item.href}><span>{item.label}</span></a></li>
          ))}
        </ul>
      </div>
    </nav>

    <!-- Seek Help CTA -->
    <div class="section-seek-help accent">
      <div class="inner-container-seek-help seek-help-cta">
        <div class="content-horizontal">
          Are you arrested or detained?
          <mdc-buttonlink
            size="32"
            href={seekHelpLink}
            rel="noopener noreferrer" inverted>
            Seek help →
            </mdc-buttonlink>
        </div>
      </div>
    </div>
</header>

  

<script>
        const menuIcon = document.querySelector('.menu-icon');
        const listIcon = document.querySelector('.list-icon');
        const xIcon = document.querySelector('.x-icon');
        const navMenu = document.querySelector('.nav-menu');
        const navLinks = document.querySelectorAll('.nav-menu li a');

        menuIcon.addEventListener('click', () => {
            const isExpanded = menuIcon.getAttribute('aria-expanded') === 'true';
            menuIcon.setAttribute('aria-expanded', !isExpanded);
            menuIcon.classList.toggle('active');
            navMenu.classList.toggle('active');
            
            // Set display property
            navMenu.style.display = !isExpanded ? 'flex' : '';
            
            // Toggle icons
            if (!isExpanded) {
                // Menu is opening - show x-icon, hide list-icon
                listIcon.style.display = 'none';
                xIcon.style.display = 'block';
            } else {
                // Menu is closing - show list-icon, hide x-icon
                listIcon.style.display = 'flex';
                xIcon.style.display = 'none';
            }
            
            // Update aria-label
            menuIcon.setAttribute('aria-label', !isExpanded ? 'Close menu' : 'Open menu');
        });

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                menuIcon.setAttribute('aria-expanded', 'false');
                menuIcon.classList.remove('active');
                navMenu.classList.remove('active');
                navMenu.style.display = '';
                
                // Reset to list icon
                listIcon.style.display = 'block';
                xIcon.style.display = 'none';
                menuIcon.setAttribute('aria-label', 'Open menu');
            });
        });

        // Close menu on browser resize
        window.addEventListener('resize', () => {
            const isExpanded = menuIcon.getAttribute('aria-expanded') === 'true';
            if (isExpanded) {
                menuIcon.setAttribute('aria-expanded', 'false');
                menuIcon.classList.remove('active');
                navMenu.classList.remove('active');
                navMenu.style.display = '';
                
                // Reset to list icon
                listIcon.style.display = 'flex';
                xIcon.style.display = 'none';
                menuIcon.setAttribute('aria-label', 'Open menu');
            }
        });
</script>