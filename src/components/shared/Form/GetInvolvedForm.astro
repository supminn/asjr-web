---
// GetInvolvedForm.astro - Newsletter/Get Involved Form Component
import './GetInvolvedForm.css';
import { t } from '../../../i18n/get';
import { Image } from 'astro:assets';

//Phosphor icons
import Chat from 'phosphor-astro/Chat.astro';
import SpeakerHigh from 'phosphor-astro/SpeakerHigh.astro';
import Hand from 'phosphor-astro/Hand.astro';
import ContactImage from '../../../assets/images/contact/getInvolved.jpg';

export interface Props {
  class?: string;
  lang?: 'en' | 'es';
}

const { class: className = '', lang = 'en' } = Astro.props as Props;
const url = Astro.url.href;
const urlSuffix = url.split('/').pop();
---

<div class="flex-container">
  <div class={`contact-form ${className}`}>
    <div class="form-header">
      <mdc-text type="body-large-regular" tagname="p" class="form-subtitle">
        {t(lang, 'form.subtitle')}
      </mdc-text>
    </div>

    <div class="contact-list">
      <ul>
        <li>
          <div class="get-invovled-icon"><Hand /></div>
          <p>{t(lang, 'form.volunteer')}</p>
        </li>
        <li>
          <div class="get-invovled-icon"><SpeakerHigh /></div>
          <p>{t(lang, 'form.advocate')}</p>
        </li>
        <li>
          <div class="get-invovled-icon"><Chat /></div>
          <p>{t(lang, 'form.stories')}</p>
        </li>
      </ul>
    </div>

    <form
      class="newsletter-form"
      onsubmit="return submitYourMessage(event)"
      novalidate
    >
      <fieldset>
        <legend class="sr-only">{t(lang, 'form.newsletterSignup')}</legend>

        <div class="form-row">
          <mdc-input
            id="first-name"
            name="firstName"
            label={t(lang, 'form.firstName')}
            placeholder={t(lang, 'form.firstNamePlaceholder')}
            required></mdc-input>

          <mdc-input
            id="last-name"
            name="lastName"
            label={t(lang, 'form.lastName')}
            placeholder={t(lang, 'form.lastNamePlaceholder')}
            required></mdc-input>
        </div>

        <mdc-input
          id="email"
          name="email"
          type="email"
          label={t(lang, 'form.emailAddress')}
          placeholder={t(lang, 'form.emailPlaceholder')}
          required></mdc-input>

        <mdc-textarea
          id="message"
          name="message"
          label={t(lang, 'form.message')}
          placeholder={t(lang, 'form.messagePlaceholder')}
          wrap="soft"
          cols="170"
          required
          autocapitalize="off"
          autocomplete="off"></mdc-textarea>

        <mdc-button type="submit" variant="primary" size="40">
          {t(lang, 'form.submit')}
        </mdc-button>
      </fieldset>
    </form>
  </div>
  {
    urlSuffix === 'contact' && (
      <Image class="image" src={ContactImage} alt={t(lang, 'form.imageAlt')} />
    )
  }
</div>

<style>
  .flex-container {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
    justify-content: center;
    padding: var(--vertical-padding) var(--horizontal-padding);
  }

  .contact-form {
    flex-grow: 1;
  }
  .image {
    width: 50%;
  }

  @media screen and (max-width: 576px) {
    .flex-container {
      flex-direction: column;
      align-items: center;
    }
    .image {
      width: 100%;
    }
  }
</style>
<script>
  import('@momentum-design/components/dist/components/button/index.js');
  import('@momentum-design/components/dist/components/input/index.js');
  import('@momentum-design/components/dist/components/icon/index.js');
  import('@momentum-design/components/dist/components/text/index.js');
  import('@momentum-design/components/dist/components/textarea/index.js');

  function submitYourMessage(event: Event) {
    event.preventDefault();

    let isValid = true;

    // Get form elements
    const firstNameInput = document.getElementById('first-name') as any;
    const lastNameInput = document.getElementById('last-name') as any;
    const emailInput = document.getElementById('email') as any;
    const messageTextarea = document.getElementById('message') as any;

    // Reset error states
    [firstNameInput, lastNameInput, emailInput, messageTextarea].forEach(
      (element) => {
        if (element) {
          element.removeAttribute('help-text');
          element.removeAttribute('help-text-type');
        }
      }
    );

    // Validate first name
    if (!firstNameInput?.value || firstNameInput.value.trim() === '') {
      firstNameInput.setAttribute('help-text', 'First name is required');
      firstNameInput.setAttribute('help-text-type', 'error');
      isValid = false;
    }

    // Validate last name
    if (!lastNameInput?.value || lastNameInput.value.trim() === '') {
      lastNameInput.setAttribute('help-text', 'Last name is required');
      lastNameInput.setAttribute('help-text-type', 'error');
      isValid = false;
    }

    // Validate email
    if (!emailInput?.value || emailInput.value.trim() === '') {
      emailInput.setAttribute('help-text', 'Email address is required');
      emailInput.setAttribute('help-text-type', 'error');
      isValid = false;
    } else {
      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailInput.value.trim())) {
        emailInput.setAttribute(
          'help-text',
          'Please enter a valid email address'
        );
        emailInput.setAttribute('help-text-type', 'error');
        isValid = false;
      }
    }

    // Validate message
    if (!messageTextarea?.value || messageTextarea.value.trim() === '') {
      messageTextarea.setAttribute('help-text', 'Message is required');
      messageTextarea.setAttribute('help-text-type', 'error');
      isValid = false;
    }

    // If all validations pass, submit the form
    if (isValid) {
      // TODO: Add your form submission logic here
      const formData = JSON.stringify({
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        email: emailInput.value,
        message: messageTextarea.value,
      });

      // Reset the form after successful submission
      (event.target as HTMLFormElement).reset();
    }

    return false;
  }

  // Make function available globally
  (window as any).submitYourMessage = submitYourMessage;
</script>
